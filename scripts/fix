#!/bin/bash

#Load File List
source /config/user-data/shadowsocks/scripts/file_list

cp $CHINADNS_SRC $CHINADNS
cp $DNS2SOCKS_SRC $DNS2SOCKS
cp $GFWLIST2DNSMASQ_SRC $GFWLIST2DNSMASQ
cp $KCPTUN_SRC $KCPTUN
cp $OBFS_LOCAL_SRC $OBFS_LOCAL
cp $SS_LOCAL_SRC $SS_LOCAL
cp $SS_REDIR_SRC $SS_REDIR
cp $SS_TUNNEL_SRC $SS_TUNNEL
cp $SSR_LOCAL_SRC $SSR_LOCAL
cp $SSR_REDIR_SRC $SSR_REDIR
cp $UDP2RAW_SRC $UDP2RAW
cp $REFRESH_SS_SRC $REFRESH_SS
cp $SS_WATCHDOG_SRC $SS_WATCHDOG
cp $DNS2SOCKS_SERVICE_SRC $DNS2SOCKS_SERVICE
cp $CHINADNS_SERVICE_SRC $CHINADNS_SERVICE
cp $SS_LOCAL_SERVICE_SRC $SS_LOCAL_SERVICE
cp $SS_REDIR_TCP_SERVICE_SRC $SS_REDIR_TCP_SERVICE
cp $SS_REDIR_UDP_SERVICE_SRC $SS_REDIR_UDP_SERVICE
cp $SSR_LOCAL_SERVICE_SRC $SSR_LOCAL_SERVICE
cp $SSR_REDIR_TCP_SERVICE_SRC $SSR_REDIR_TCP_SERVICE
cp $SSR_REDIR_UDP_SERVICE_SRC $SSR_REDIR_UDP_SERVICE
cp $KCPTUN_SERVICE_SRC $KCPTUN_SERVICE
cp $UDP2RAW_KCPTUN_SERVICE_SRC $UDP2RAW_KCPTUN_SERVICE
cp $UDP2RAW_SS_SERVICE_SRC $UDP2RAW_SS_SERVICE
cp $SS_WATCHDOG_SERVICE_SRC $SS_WATCHDOG_SERVICE

cp $RULES_UPDATE_SRC $RULES_UPDATE

kernel_verison=`uname -r`
if [ ! -e $XT_SOCKET -a "$kernel_verison" = "3.10.20-UBNT" ]; then
  cp $XT_SOCKET_SRC $XT_SOCKET
fi

if [ ! -e $XT_TPROXY -a "$kernel_verison" = "3.10.20-UBNT" ]; then
  cp $XT_TPROXY_SRC $XT_TPROXY
fi

update-rc.d ${CHINADNS_SERVICE##*/} stop 20 0 1 6 . 
update-rc.d ${DNS2SOCKS_SERVICE##*/} stop 21 0 1 6 . 
update-rc.d ${SSR_LOCAL_SERVICE##*/} stop 22 0 1 6 . 
update-rc.d ${SSR_REDIR_TCP_SERVICE##*/} stop 23 0 1 6 . 
update-rc.d ${SSR_REDIR_UDP_SERVICE##*/} stop 23 0 1 6 . 
update-rc.d ${SS_LOCAL_SERVICE##*/} stop 24 0 1 6 . 
update-rc.d ${SS_REDIR_TCP_SERVICE##*/} stop 25 0 1 6 . 
update-rc.d ${SS_REDIR_UDP_SERVICE##*/} stop 25 0 1 6 . 
update-rc.d ${KCPTUN_SERVICE##*/} stop 25 0 1 6 . 
update-rc.d ${UDP2RAW_KCPTUN_SERVICE##*/} stop 25 0 1 6 . 
update-rc.d ${UDP2RAW_SS_SERVICE##*/} stop 25 0 1 6 . 
update-rc.d ${SS_WATCHDOG_SERVICE##*/} stop 25 0 1 6 . 
depmod 
